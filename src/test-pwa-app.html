<html><head><link rel="import" href="../bower_components/paper-button/paper-button.html"><link rel="import" href="../bower_components/paper-toast/paper-toast.html"><link rel="import" href="../bower_components/polymer/polymer-element.html"><link rel="import" href="fragments/main-fragment.html"><link rel="import" href="fragments/splash-fragment.html"></head><body><dom-module id="test-pwa-app"><template><style>:host{background:#eeeeee;display:block;height:100%;}paper-toast{font-size:1em;}paper-toast paper-button{color:#eeff41;}#frame{height:100%;width:100%;}#frame > *{height:100%;position:absolute;width:100%;}</style><div id="frame"><div><splash-fragment id="splashFragment"></splash-fragment></div><div><main-fragment id="mainFragment"></main-fragment></div></div><paper-toast id="toast"><paper-button id="positiveButton" on-tap="_onToastPositiveButtonTapped"></paper-button></paper-toast></template><script>var TestPwaApp=function(a){function b(){babelHelpers.classCallCheck(this,b);var c=babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return c.fragments=[],c.visibleFragments=[],c}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,null,[{key:'is',get:function(){return'test-pwa-app'}}]),babelHelpers.createClass(b,[{key:'_onToastPositiveButtonTapped',value:function(){window.location.reload(!0)}},{key:'initFragments',value:function(){var d=this;this.fragments=[this.$.mainFragment,this.$.splashFragment],this.fragments.forEach(function(f){f.frame=d,f.style.display='none'})}},{key:'ready',value:function(){babelHelpers.get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),'ready',this).call(this),navigator.serviceWorker&&this.registerServiceWorker(),this.initFragments(),this.setVisibleFragment(this.$.splashFragment)}},{key:'registerServiceWorker',value:function(){var d=this;navigator.serviceWorker.register('sw.js').then(function(f){var g=!1;try{var h=Object.defineProperty({},'passive',{get:function(){g=!0}});window.addEventListener('test',null,h)}catch(i){}f.addEventListener('updatefound',function(){var k,l,i=f.active,j=f.installing;i?(l='Reload to update',k='New version available'):(l='Reload to finish',k='Installation is almost complete'),j.addEventListener('statechange',function(){d.$.positiveButton.textContent=l,d.$.toast.text=k,'activated'==j.state&&d.$.toast.show({duration:Infinity})},!!g&&{passive:!0})},!!g&&{passive:!0})})}},{key:'setVisibleFragment',value:function(d){-1!==this.visibleFragments.indexOf(d)||(this.visibleFragments.forEach(function(f){f.style.display='none','function'===typeof f.onInvisible&&f.onInvisible()}),d.style.display='','function'===typeof d.onVisible&&d.onVisible(),this.visibleFragments=[d])}},{key:'setVisibleFragmentByTag',value:function(d){this.setVisibleFragment(this.shadowRoot.querySelector(d))}}]),b}(Polymer.Element);window.customElements.define(TestPwaApp.is,TestPwaApp),window.addEventListener('beforeinstallprompt',function(a){return console.log('> beforeinstallprompt'),localStorage.getItem('showed-install-banner')?void a.preventDefault():void a.userChoice.then(function(){localStorage.setItem('showed-install-banner',!0)})});</script></dom-module></body></html>